{% extends 'base.html.twig' %}

{% block title %}{{ article.titre }}{% endblock %}

{% block body %}
    <div class="container mt-4">
        <h1>{{ article.titre }}</h1>

        <table class="table table-bordered mt-4">
            <tbody>
                <tr>
                    <th>ID</th>
                    <td>{{ article.id }}</td>
                </tr>
                <tr>
                    <th>Contenu</th>
                    <td>{{ article.contenu|nl2br }}</td>
                </tr>
                <tr>
                    <th>Slug</th>
                    <td>{{ article.slug }}</td>
                </tr>
                <tr>
                    <th>Artiste</th>
                    <td>{{ article.artiste }}</td>
                </tr>
                <tr>
                    <th>Date de publication</th>
                    <td>{{ article.datePublication ? article.datePublication|date('d/m/Y à H:i') : '' }}</td>
                </tr>
            </tbody>
        </table>

        <div class="mb-3">
            <a href="{{ path('app_article_index') }}" class="btn btn-secondary">Retour à la liste</a>

            {% if is_granted('ROLE_ADMIN') %}
                <a href="{{ path('app_article_edit', {'id': article.id}) }}" class="btn btn-warning">Modifier</a>
                {{ include('article/_delete_form.html.twig') }}
            {% endif %}
        </div>

        <hr>

        <h3 class="mt-5">Commentaires</h3>

        {% if article.commentaires is not empty %}
            <ul class="list-group mb-4">
                {% for commentaire in article.commentaires %}
                    <li class="list-group-item">
                        <strong>{{ commentaire.auteur.pseudo }}</strong>
                        <small class="text-muted">— {{ commentaire.createdAt|date('d/m/Y à H:i') }}</small>
                        <p class="mb-0 mt-1">{{ commentaire.contenu }}</p>
                        {% if commentaire.note is defined %}
                            <small>Note : {{ commentaire.note }} / 5</small>
                        {% endif %}
                        {% if app.user and commentaire.auteur == app.user %}
                            <form method="post" action="{{ path('app_commentaire_delete', {'id': commentaire.id}) }}" onsubmit="return confirm('Supprimer ce commentaire ?');">
                                <input type="hidden" name="_token" value="{{ csrf_token('delete_comment_' ~ commentaire.id) }}">
                                <button class="btn btn-sm btn-outline-danger mt-2">Supprimer</button>
                            </form>
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>Aucun commentaire pour le moment.</p>
        {% endif %}

        {% if commentaireForm is defined %}
            <h4>Ajouter un commentaire</h4>
            {{ form_start(commentaireForm) }}
                {{ form_row(commentaireForm.contenu) }}
                {{ form_row(commentaireForm.note) }}
                <button class="btn btn-primary">Envoyer</button>
            {{ form_end(commentaireForm) }}
        {% else %}
            <p class="mt-3"><a href="{{ path('app_login') }}">Connectez-vous</a> pour commenter cet article.</p>
        {% endif %}
    </div>
{% endblock %}